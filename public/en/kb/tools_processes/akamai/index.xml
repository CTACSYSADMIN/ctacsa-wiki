<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Akamai on Documentation for Hugo Learn Theme</title>
    <link>//localhost:1313/en/kb/tools_processes/akamai/</link>
    <description>Recent content in Akamai on Documentation for Hugo Learn Theme</description>
    <generator>Hugo</generator>
    <language>en</language>
    <lastBuildDate>Sat, 05 Feb 2022 10:31:29 -0500</lastBuildDate>
    <atom:link href="//localhost:1313/en/kb/tools_processes/akamai/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>akamai content purge</title>
      <link>//localhost:1313/en/kb/tools_processes/akamai/akamai-content-purge/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/akamai/akamai-content-purge/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysic Corporation)  &#xA;=================================================&#xA;&#xA;Subject: VOC display error&#xA;&#xA;Revision History:&#xA;    2017-10-31 14:44:41 - Version 1 created by bao&#xA;&#xA;Details: Akamai content purge&#xA;&#xA;Log into akamai &amp;gt; Publish &amp;gt; Content Control Utility &amp;gt; Ion Premier &amp;gt; Continue &amp;gt; [Use with Caution!] Refresh ALL URLs/ARLs Associated with Specific CP Codes&#xA;&#xA;Select a CP code, and ‘Start Refresh Content’&#xA;&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be &#xA;disclosed in any manner to a third party without the prior written consent of &#xA;CTAC.```&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>Akamai log processing script</title>
      <link>//localhost:1313/en/kb/tools_processes/akamai/akamai-log-processing-script/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/akamai/akamai-log-processing-script/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)&#xA;=================================================&#xA;&#xA;Subject: Akamai log processing script&#xA;&#xA;Revision History:&#xA;    2015-05-18 16:23:00 - Version 1 created by John Kennedy&#xA;&#xA;Details: (include steps to reproduce, symptoms, corrective actions, contact information, links and a any other helpful information)&#xA;&#xA;Purpose - Akamai holds their scripts for 8 days. This retention is not long enough for HHS and there is no possibility for Splunk processing while the logs are on the Akamai servers. This script will sync the Akamai logs with the Akamai server, allow for Splunk processing then push the files to S3 and eventually AWS Glacier for archival.&#xA;&#xA;The script currently lives on toolstack-01.svcs.hhs.local in /usr/local/bin/log-pull.sh. A copy also sits in /home/jkennedy/log-pull.sh (Note LOCALFOLDER location of this copy) and in the &amp;#34;root&amp;#34; of the S3 bucket s3://hhs-akamai-log/. The Akamai data is put into /var/log/akamai/data and the script log files are put in /var/log/akamai/logs.&#xA;&#xA;Requirements - The script requires that the Akamai ssh key exist in ${HOME}/.akamai/akamaisync and that the AWS access and secret key exist in ${HOME}/.aws/creds with the following format:&#xA;aws_access_key_id = &amp;lt;ACCESS_KEY&amp;gt;&#xA;aws_secret_access_key = &amp;lt;SECRET_KEY&amp;gt;&#xA;The script also requires a location for the Akamai log and script log files to sit but will create them if they do not exist.&#xA;&#xA;Use - The script is designed to run from cron. The only part that needs to be edited is the LOCALFOLDER variable on line 6. This will cause the user to think before putting Akamai files in random places and clogging up filesystem space.&#xA;&#xA;Cron - The script is run from root&amp;#39;s crontab at 0605 and 1805 every day. It will delete the 0400-0500, 0500-0600 files and 1600-1700, 1700-1800 files if applicable. If running the script outside of cron, these same files will be deleted even if there are later files.&#xA;&#xA;Methods - The script uses rsync sync with the --delete flag to pull only new files and delete files that no longer exist on the Akamai servers. It uses the s3cmd sync command to only upload new files to the S3 bucket. &#xA;&#xA;File retention - Akamai only holds 8 days worth of files and as such, the toolstack server will only have 8 days worth of files. The S3 bucket will hold 6 months of logs then push logs to AWS Glacier to be archived for a further 6 months before being deleted.&#xA;&#xA;Splunk - Splunk is currently configured as a forwarder on toolstack-01.svcs.hhs.local. It processes the Akamai files in /var/log/akamai/data/ folder.&#xA;&#xA;Warning - As the HHS footprint builds so will the Akamai logs. The current 8 day retention uses 2.3 GB of space. If Akamai builds too much the /var/log/ file system could fill beyond current capacity:&#xA;&#xA;# df -h /var/log&#xA;/dev/mapper/vg1-varlog   9.8G  3.2G  6.1G  35% /var/log&#xA;&#xA;It may be necessary to move the Akamai files to their own filesystem in the future.&#xA;&#xA;====== log-pull.sh as of 5-18-2015 ======&#xA;&#xA;#!/bin/bash&#xA;&#xA;## User definied variables&#xA;&#xA;# Log files&#xA;LOCALFOLDER=&amp;#34;/home/jkennedy/akamai/&amp;#34;&#xA;LOG1=&amp;#34;logs/akamai_log_`date &amp;#39;+%Y%m%d-%H-%M-%S&amp;#39;`.log&amp;#34;&#xA;LOG2=&amp;#34;logs/akamai_prod_summary.log&amp;#34;&#xA;DATA=&amp;#34;${LOCALFOLDER}data/&amp;#34;&#xA;&#xA;# First make sure that the akamaisync file exists. Can&amp;#39;t run without it.&#xA;if [[ -f ${HOME}/.akamai/akamaisync ]]&#xA;then&#xA;   x=0&#xA;else&#xA;   echo &amp;#34;Akamai key does not exist. &amp;#34;&#xA;   exit 1&#xA;fi&#xA;# Same for AWS creds&#xA;if [[ -f ${HOME}/.aws/creds ]]&#xA;then&#xA;   x=0&#xA;else&#xA;   echo &amp;#34;AWS creds file does not exist. &amp;#34;&#xA;   exit 2&#xA;fi&#xA;&#xA;# Creds&#xA;SSH_KEY=&amp;#34;${HOME}/.akamai/akamaisync&amp;#34;&#xA;AWS_KEY=`cat ${HOME}/.aws/creds | grep &amp;#34;aws_access_key_id&amp;#34; | cut -d= -f2 | cut -d&amp;#34; &amp;#34; -f2`&#xA;AWS_SECRET=`cat ${HOME}/.aws/creds | grep &amp;#34;aws_secret_access_key&amp;#34; | cut -d= -f2 | cut -d&amp;#34; &amp;#34; -f2`&#xA;&#xA;# rsync options&#xA;FLAGS=&amp;#34;--delete-before -auv --stats&amp;#34;&#xA;DEST=&amp;#34;${DATA}&amp;#34;&#xA;SOURCE=&amp;#34;sshacs@hhs.upload.akamai.com:/218317/&amp;#34;&#xA;&#xA;## Environmental variables&#xA;PATH=&amp;#34;/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin&amp;#34;&#xA;export PATH&#xA;param=&amp;#34;$1&amp;#34;&#xA;MON=`date +%m`&#xA;DAY=`date +%d`&#xA;HOUR=`date +%H`&#xA;MORN=(${DAY}0500 ${DAY}0600)&#xA;NIGHT=(${DAY}1700 ${DAY}1800)&#xA;&#xA;## Command Paths&#xA;RSYNC=/usr/bin/rsync&#xA;SSH_AGENT=/usr/bin/ssh-agent&#xA;SSH_ADD=/usr/bin/ssh-add&#xA;SSH=/usr/bin/ssh&#xA;&#xA;## Create ssh agent and add Akamai key&#xA;eval `${SSH_AGENT}` &amp;gt; /dev/null&#xA;${SSH_ADD} ${SSH_KEY} &amp;gt; /dev/null&#xA;&#xA;## Let&amp;#39;s do some work...&#xA;# Make sure our folders exist&#xA;if [[ -d ${LOCALFOLDER} ]]&#xA;then&#xA;    x=0&#xA;else&#xA;    mkdir ${LOCALFOLDER}&#xA;fi&#xA;&#xA;if [[ -d ${LOCALFOLDER}/logs ]]&#xA;then&#xA;    x=0&#xA;else&#xA;    mkdir ${LOCALFOLDER}/logs&#xA;    echo &amp;#34;Creating folder ${LOCALFOLDER}/logs..&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG2}&#xA;fi&#xA;&#xA;if [[ -d ${DATA} ]]&#xA;then&#xA;    x=0&#xA;else&#xA;    mkdir ${DATA}&#xA;    echo &amp;#34;Creating folder ${DATA}...&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG2}&#xA;fi&#xA;&#xA;# Set up log format&#xA;echo &amp;#34;=================================&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo &amp;#34;   &amp;#34; `date` &amp;#34;   &amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo &amp;#34;=================================&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo `date` &amp;#34; Start rsync &amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG2}&#xA;&#xA;echo &amp;#34;-----------------------&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo &amp;#34;      RSYNC&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo &amp;#34;-----------------------&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;#HOUR=18&#xA;# Run rscync&#xA;${RSYNC} ${FLAGS} -e &amp;#34;${SSH} -i ${SSH_KEY} -o StrictHostKeyChecking=no&amp;#34; ${SOURCE} ${DEST} &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}  2&amp;gt;&amp;amp;1&#xA;&#xA;# For the 6am run&#xA;if [[ ${HOUR} == 6 ]]&#xA;then&#xA;  for k in ${MORN[*]}&#xA;  do&#xA;      find ${DEST} -name &amp;#34;*${k}*&amp;#34; -type f -exec ls -l {} \; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;      find ${DEST} -name &amp;#34;*${k}*&amp;#34; -type f -exec rm -f {} \;&#xA;  done&#xA;fi&#xA;&#xA;# For the 6pm run&#xA;if [[ ${HOUR} == 18 ]]&#xA;then&#xA;  for k in ${NIGHT[*]}&#xA;  do&#xA;      find ${DEST} -name &amp;#34;*121700*&amp;#34; -type f -exec ls -l {} \; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;      find ${DEST} -name &amp;#34;*${k}*&amp;#34; -type f -exec rm -f {} \;&#xA;  done&#xA;fi&#xA;&#xA;echo `date` &amp;#34; End rsync &amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}/${LOG2}&#xA;&#xA;## Stop ssh_agent now that we are done.&#xA;if [ &amp;#34;${SSH_AGENT_PID}&amp;#34; != &amp;#34;&amp;#34; ]; then&#xA;    kill ${SSH_AGENT_PID}&#xA;fi&#xA;&#xA;## Push files to S3&#xA;echo &amp;#34;-----------------------&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo &amp;#34;        S3&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;echo &amp;#34;-----------------------&amp;#34; &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;# aws S3 sync ${DATA} s3://hhs-akamai-log/&#xA;#echo &amp;#34;s3cmd --access_key=${AWS_KEY} --secret_key=${AWS_SECRET} sync ${DATA} s3://hhs-akamai-log/ &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&amp;#34;&#xA;#read dummyvar&#xA;s3cmd --access_key=&amp;#34;${AWS_KEY}&amp;#34; --secret_key=&amp;#34;${AWS_SECRET}&amp;#34; sync ${DATA} s3://hhs-akamai-log/ &amp;gt;&amp;gt; ${LOCALFOLDER}${LOG1}&#xA;&#xA;====== log-pull.sh as of 5-18-2015 ======&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be&#xA;disclosed in any manner to a third party without the prior written consent of&#xA;CTAC.&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
  </channel>
</rss>
