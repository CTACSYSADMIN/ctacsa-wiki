<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Splunk on Documentation for Hugo Learn Theme</title>
    <link>//localhost:1313/en/kb/tools_processes/splunk/</link>
    <description>Recent content in Splunk on Documentation for Hugo Learn Theme</description>
    <generator>Hugo</generator>
    <language>en</language>
    <lastBuildDate>Sat, 05 Feb 2022 10:31:29 -0500</lastBuildDate>
    <atom:link href="//localhost:1313/en/kb/tools_processes/splunk/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>sample splunk searches</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/sample-splunk-searches/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/sample-splunk-searches/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)  &#xA;=================================================&#xA;&#xA;Subject: Sample Splunk searches&#xA;&#xA;Revision History:&#xA;    2016-01-07 11:12:00 - Version 1 created by Bao&#xA;&#xA;Details: (include steps to reproduce, symptoms, corrective actions, contact information, links and a any other helpful information)&#xA;&#xA;index=ws curl earliest=-7d@d | stats count by host | head 10 | sort count&#xA;&#xA;index=ws wget earliest=-7d@d | stats count by host | head 10 | sort count&#xA;&#xA;index=ws status=400 earliest=-7d@d | stats count by host | head 10 | sort count&#xA;&#xA;index=as error earliest=-7d@d | stats count by host | head 10 | sort count&#xA;&#xA;`aws-cloudtrail((aws_account_id=&amp;#34;*&amp;#34;),  (region=&amp;#34;**&amp;#34;) )` eventSource=iam* `aws_service(&amp;#34;.*&amp;#34;, &amp;#34;IAM&amp;#34;, &amp;#34;true&amp;#34;)` earliest=-7d@d | lookup unauthorized_errorCode.csv errorCode OUTPUT Unauthorized | stats count count(eval(match(_raw, &amp;#34;errorCode&amp;#34;))) as errors count(Unauthorized) as Unauthorized by eventName |                 stats sum(count) as count sum(errors) as errors                 | nadefault errors count&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be &#xA;disclosed in any manner to a third party without the prior written consent of &#xA;CTAC.&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>splunk db size too large</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/splunk-db-size-too-large/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/splunk-db-size-too-large/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)&#xA;=================================================&#xA;&#xA;Subject: Splunk DB size has grown very large&#xA;&#xA;Revision History:&#xA;    2016-01-14 08:10 - Version 1 created by Jeannette Rigor&#xA;&#xA;Details: (include steps to reproduce, symptoms, corrective actions, contact information, links and a any other helpful information)&#xA;&#xA;Problem: Splunk DB is growing too large.&#xA;Cause: Splunk is using default setting for Max DB size&#xA;&#xA;Resolution:&#xA;Check the size of the Splunk DB, the DB is located in $SPLUNK_HOME/var/lib/splunk/defaultdb&#xA;&#xA;Edit the maxTotalDataSizeMB in the foloowing directory:&#xA;&amp;gt; /opt/splunk/etc/system/local/index.conf&#xA;If there index.conf does not exist in system/local ..&#xA;DO NOT change the index.conf in the ../system/default directory&#xA;&#xA;Create a new indexes.conf file into the /opt/splunk/etc/system/local/ directory, and add the following value:&#xA;----------------&#xA;&#xA;# overwrites&#xA;################################################################################&#xA;# index specific defaults&#xA;################################################################################&#xA;[main]&#xA;maxTotalDataSizeMB = {set this value to be smaller than the surrent size of the DB}&#xA;&#xA;-----------------&#xA;&#xA;restart splunk for the new config to take effect&#xA;&#xA;&amp;gt; service splunk restart&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be&#xA;disclosed in any manner to a third party without the prior written consent of&#xA;CTAC.```&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>Splunk forwarder manual install</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/splunk-forwarder-manual-install/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/splunk-forwarder-manual-install/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)  &#xA;=================================================&#xA;&#xA;Subject: Manually Installing Splunk Forwarder (GSA) Environment&#xA;&#xA;Revision History:&#xA;    2015-04-16 16:52:00 - Version 1 created by Bao&#xA;&#xA;Details: (include steps to reproduce, symptoms, corrective actions, contact information, links and a any other helpful information)&#xA;&#xA;Links:&#xA;     &#xA;&#xA;1) Retrieve the Splunk forwarder from Puppet Master. The file is in:&#xA;/etc/puppetlabs/puppet/cmp_puppet_rp/environments/production/modules/splunk/files/universalforwarder/linux/&#xA;&#xA;2) scp the file to the sever where you’d like to set up the Splunkforwarder&#xA;&#xA;3a) Create an outputs.conf file:&#xA;touch /opt/splunkforwarder/etc/system/local/outputs.conf&#xA;&#xA;3b) Ensure the contents of outputs.conf as follows (substitute your splunk server accordingly):&#xA;&#xA;[default] &#xA;defaultGroup=splunks-01.domain.local_9997 &#xA;&#xA;[tcpout:splunks-01.domain.local_9997] &#xA;server=splunks-01.domain.local:9997 &#xA;&#xA;4a) create an inputs.conf file:&#xA;touch /opt/splunkforwarder/etc/system/local/inputs.conf&#xA;&#xA;4b) Ensure the contents of inputs.conf (substitute your hostname accordingly):&#xA;[default] &#xA;host = openvpn.domain.local &#xA;&#xA;5) Configure the forwarder to send logs to the Splunk server via port 9997. You may be prompted for a login/password. The default ‘admin/changeme’ has worked. If not, check 1Password: &#xA;/opt/splunkforwarder/bin/splunk add forward-server splunk-01.svcs.gsa.local:9997&#xA;&#xA;6) Add logs to the forwarder. Again, you may be prompted for login/password&#xA;/opt/splunkforwarder/bin/splunk add monitor /path/to/app/logs/ &#xA;&#xA;Optional:&#xA;add options to the above command:&#xA;/opt/splunkforwarder/bin/splunk add monitor /path/to/app/logs/  -index main -sourcetype %app%&#xA;&#xA;&#xA;7) restart splunk forwarder&#xA;/opt/splunkforwarder/bin/splunk restart&#xA;&#xA;&#xA;8) Log into the Splunk UI and confirm that logs are being sent from the server.&#xA;&#xA;Troubleshooting&#xA;This command tests the forwarder. It has some useful output for when you don’t see logs coming into the Splunk server:&#xA;/opt/splunkforwarder/bin/splunk list forward-server&#xA;&#xA;&#xA;&#xA;==== some useful commands&#xA;from: https://answers.splunk.com/answers/50082/how-do-i-configure-a-splunk-forwarder-on-linux.html&#xA;&#xA;enable splunk forwarder:&#xA;/opt/splunkforwarder/bin/splunk enable boot-start &#xA; &#xA; enable listening on splunk index&#xA; /opt/splunk/bin/splunk enable listen 9997&#xA;&#xA;add forward server&#xA; /opt/splunkforwarder/bin/splunk add forward-server&#xA;&#xA;test forward connection: &#xA;/opt/splunkforwarder/bin/splunk list forward-server&#xA;&#xA;add logs:&#xA; /opt/splunkforwarder/bin/splunk add monitor /var/log/ -index main -sourcetype %app%&#xA;&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be &#xA;disclosed in any manner to a third party without the prior written consent of &#xA;CTAC.```&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>splunk misc commands</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/splunk-misc-commands/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/splunk-misc-commands/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)  &#xA;=================================================&#xA;&#xA;Subject: APT KEY EXPIRED ERROR&#xA;&#xA;Revision History:&#xA;    2019-02-25 08:49:51 - Version 1 created by Bao Nguyen&#xA;&#xA;Details: (include steps to reproduce, symptoms, corrective actions, contact information, links and a any other helpful information)&#xA;&#xA;/opt/splunk/bin/splunk btool check --debug&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be &#xA;disclosed in any manner to a third party without the prior written consent of &#xA;CTAC.```&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>splunk offload frozen buckets</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/splunk-offload-frozen-buckets/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/splunk-offload-frozen-buckets/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)&#xA;=================================================&#xA;&#xA;Subject: Splunk offload frozen buckets&#xA;&#xA;Revision History:&#xA;    2018-04-04 10:42 - Version 1 created by Bao Nguyen&#xA;&#xA;Details: (include steps to reproduce, symptoms, corrective actions, contact information, links and a any other helpful information)&#xA;&#xA;Problem: Splunk disk space is too large &amp;amp; consumed by frozen buckets&#xA;&#xA;Applies to HHS Splunk&#xA;&#xA;Resolution:&#xA;Offload frozen buckets&#xA;&#xA;- ssh into splunk server&#xA;- cd /opt/splunk/var/lib/splunk/&#xA;- du | sort -n -r | head -10&#xA;- review the output of the du command and cd to the frozen directory of that index&#xA;  eg: if akamai is the largest directory, then your command would be:&#xA;&#xA;  cd akamai/frozen&#xA;&#xA;- for x in $(ls -l | awk &amp;#39;{print $9}&amp;#39;); do echo $x; s3cmd put $x s3://DCD_File_Backup/&amp;lt;&amp;lt;&amp;lt; HOSTNAME&amp;gt;&amp;gt;&amp;gt;/frozenbuckets/&amp;lt;&amp;lt;&amp;lt;INDEX&amp;gt;&amp;gt;&amp;gt;/ --recursive &amp;amp;&amp;amp; rm -rf $x;  done&#xA;&#xA;&#xA;  e.g. if you are on splunk-02.svcs.hhs.local, and akamai is the index then your command would be:&#xA;  for x in $(ls -l | awk &amp;#39;{print $9}&amp;#39;); do echo $x; s3cmd put $x s3://DCD_File_Backup/splunk-02.svcs.hhs.local/frozenbuckets/akamai/ --recursive &amp;amp;&amp;amp; rm -rf $x;  done&#xA;&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be&#xA;disclosed in any manner to a third party without the prior written consent of&#xA;CTAC.```&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>splunk orphaned search owned by unique disabled users</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/splunk-orphaned-search-owned-by-unique-disabled-users/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/splunk-orphaned-search-owned-by-unique-disabled-users/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)  &#xA;=================================================&#xA;&#xA;Subject: ADDE upgrade&#xA;&#xA;Revision History:&#xA;    2019-04-06 15:55:00 - Version 1 created by Bao&#xA;&#xA;&#xA;Links:&#xA;- &#xA;Relevant servers:&#xA;- Splunk SH&#xA;&#xA;Background:&#xA;If a user has a saved search in Splunk but that user has been deleted, you&amp;#39;ll see a message in Splunk about an orphaned search.&#xA;&#xA;Prerequisites&#xA;None&#xA;&#xA;Steps:&#xA;- log into your splunk search head. &#xA;- cd /opt/splunk/etc/users/&amp;lt;name of user&amp;gt;/search/local&#xA;- vi savedsearches.conf&#xA;- determine if this search is still needed. if it is not, then remove it.&#xA;- If the search is still needed, then assign the contents of this file into another user that is still active.&#xA;- restart splunk.&#xA;&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be &#xA;disclosed in any manner to a third party without the prior written consent of &#xA;CTAC.&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>Splunk setting data retention best practices</title>
      <link>//localhost:1313/en/kb/tools_processes/splunk/splunk-setting-data-retention-best-practices/</link>
      <pubDate>Sat, 05 Feb 2022 10:31:29 -0500</pubDate>
      <guid>//localhost:1313/en/kb/tools_processes/splunk/splunk-setting-data-retention-best-practices/</guid>
      <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Knowledge Base Article - CTAC (Communications Training Analysis Corporation)&#xA;=================================================&#xA;&#xA;Subject: Splunk data retention&#xA;&#xA;Revision History:&#xA;    2016-02-12 12:19:00 - Version 1 created by Bao&#xA;&#xA;&#xA;Useful URLs:&#xA;&#x9;- http://blogs.splunk.com/2011/01/03/managing-index-sizes-in-splunk/ (not maintained)&#xA;&#x9;- https://wiki.splunk.com/Deploy:BucketRotationAndRetention&#xA;&#x9;- https://answers.splunk.com/answers/217493/splunk-time-based-retention.html?utm_source=typeahead&amp;amp;utm_medium=newquestion&amp;amp;utm_campaign=no_votes_sort_relev&#xA;&#x9;- https://answers.splunk.com/answers/106113/how-to-calculate-the-index-size-from-all-indexers.html&#xA;&#x9;- http://docs.splunk.com/Documentation/Splunk/6.0/admin/Indexesconf&#xA;&#x9;- Restoring archived data: http://docs.splunk.com/Documentation/Splunk/6.1/Indexer/Restorearchiveddata&#xA;&#xA;&#xA;- Why do we even need buckets?&#xA;Splunk places its data in buckets.&#xA;&#xA;Data enters Splunk and is first put into hot buckets. You then create policies to move them to warm, cold, and (if applicable) frozen. You can search warm, hot, and cold buckets. Cannot search frozen buckets. If you need data from frozen buckets, you will need to move them to a thawed directory. Unless you specify a frozen bucket, data will not be moved to a frozen bucket; it will instead be deleted. By default the bucket size is 10GB for 64-bit systems. &#xA;&#xA;Before we get into changing any of our settings, let’s start with some variables that we’ll be using in indexes.conf and their definitions:&#xA;minFreeSpace&#xA;&#x9;- amount of available free disk space until Splunk halts indexing (in MB)&#xA;&#x9;- default = 2GB (2000 MB).&#xA;&#x9;- add this setting to server.conf&#xA;&#xA;maxHotBuckets&#xA;&#x9;- Maximum number of Hot buckets to be spawned.&#xA;&#x9;- Default for Main index is 10. Default for others is 3.&#xA;maxDataSize&#xA;&#x9;- Bucket Size in MB.&#xA;&#x9;- Defaults:&#xA;&#x9;&#x9;- auto: 750MB&#xA;&#x9;&#x9;- auto_high_volume: 10 GB.&#xA;maxWarmDBCount&#xA;&#x9;- total number of warm buckets.&#xA;&#x9;- warm -&amp;gt; cold; once the number of maxWarmDBCount is reached, the older will be rolled.&#xA;&#x9;- Remember, Indexed data transitions from hot &amp;gt; warm &amp;gt; cold.  &#xA;&#x9;- Default = 300&#xA;- maxTotalDataSizeMB&#xA;&#x9;- (this is the total size for an index (hot + warm + cold)&#xA;&#x9;- You can use the size of an index to determine when data gets frozen and removed from the index. &#xA;&#x9;- If an index grows larger than its maximum specified size, the oldest data is rolled to the frozen state.&#xA;&#x9;- Default: 500,000 MB&#xA;- frozenTimePeriodInSecs&#xA;&#x9;- You can use the age of data to determine when a bucket gets rolled to frozen. &#xA;&#x9;- When the most recent data in a particular bucket reaches the configured age, the entire bucket is rolled.&#xA;&#x9;- Defaults to 188697600 (6 years)&#xA;- maxHotSpanSecs&#xA;&#x9;- From hot to warm if its size reaches a limit `maxDataSize` or its lifetime is older than `maxHotSpanSecs`, or by using a manual command to roll the buckets.&#xA;&#x9;- Defaults to 7776000 seconds (90 days).&#xA;&#xA;&#xA;First, let’s determine how much disk space we have:&#xA;example df -h:&#xA;root@splunk-02:~# df -h&#xA;Filesystem              Size  Used Avail Use% Mounted on&#xA;udev                    7.4G   12K  7.4G   1% /dev&#xA;tmpfs                   1.5G  396K  1.5G   1% /run&#xA;/dev/xvda1              7.8G  1.8G  5.6G  25% /&#xA;none                    4.0K     0  4.0K   0% /sys/fs/cgroup&#xA;none                    5.0M     0  5.0M   0% /run/lock&#xA;none                    7.4G     0  7.4G   0% /run/shm&#xA;none                    100M     0  100M   0% /run/user&#xA;/dev/xvdb                37G   49M   35G   1% /mnt&#xA;/dev/mapper/vg1-varlog  4.8G  105M  4.5G   3% /var/log&#xA;/dev/mapper/vg1-home    4.8G  148M  4.4G   4% /home&#xA;/dev/mapper/vg1-tmp     3.9G  8.1M  3.6G   1% /tmp&#xA;/dev/mapper/vg1-opt     405G  332G   55G  86% /opt&#xA;root@splunk-02:~#&#xA;&#xA;&#xA;&#xA;Then let’s find out how many indexes we have and how much space each index is consuming. Log into the Splunk UI and run the following search:&#xA;| eventcount summarize=false index=* report_size=true | eval MB=(size_bytes/1024)/1024 | stats sum(MB) by index, server&#xA;&#xA;Updated, perhaps a more useful query to determine how much space each of the indexes are consuming&#xA;| rest /services/data/indexes | where disabled = 0 | search NOT title = &amp;#34;_*&amp;#34; | eval currentDBSizeGB = round( currentDBSizeMB / 1024) | where currentDBSizeGB &amp;gt; 0 | table splunk_server title summaryHomePath_expanded minTime maxTime currentDBSizeGB totalEventCount frozenTimePeriodInSecs coldToFrozenDir maxTotalDataSizeMB | rename minTime AS earliest maxTime AS latest summaryHomePath_expanded AS index_path currentDBSizeGB AS index_size totalEventCount AS event_cnt frozenTimePeriodInSecs AS index_retention coldToFrozenDir AS index_path_frozen maxTotalDataSizeMB AS index_size_max title AS index&#xA;&#xA;&#xA;&#xA;&#xA;Use the following formulas to determine what values to set:&#xA;&#xA;- LocalDiskSpace:&#xA;LocalDiskSpace = minFreeSpace + (maxHotBuckets * maxDataSize) + (maxWarmDBCount * maxDataSize)&#xA;LocalDiskSpace&#x9;= 2GB + ( 10 * 20GB ) + (20 * 10G)&#xA;&#x9;&#x9;&#x9;= 402GB&#xA;&#xA;&#xA;&#xA;- maxWarmDBCount:&#xA;maxWarmDBCount&#x9;= (LocalDiskSpace-minFreeSpace-(maxHotBuckets*maxDataSize))/maxDataSize&#xA;&#x9;&#x9;&#x9;&#x9;= ( 400G - 2G - (20 * 10G ) / 10G&#xA;&#x9;&#x9;&#x9;&#x9;= (398 - 200) / 10G&#xA;&#x9;&#x9;&#x9;&#x9;= 20&#xA;&#xA;&#xA;…or another version of the above:&#xA;maxWarmDBCount&#x9;= LocalDiskSpace/maxDataSize – minFreeSpace/maxDataSize – maxHotBuckets&#xA;&#x9;&#x9;&#x9;&#x9;= 400G/10G - 2G/10G - 20&#xA;&#x9;&#x9;&#x9;&#x9;= 40 - .2 - 20&#xA;&#x9;&#x9;&#x9;&#x9;= 38.8 - 20&#xA;&#x9;&#x9;&#x9;&#x9;= 20&#xA;&#xA;- maxTotalDataSizeMB:&#xA;maxTotalDataSizeMB &#x9;= LocalDiskSpace – minFreeSpace&#xA;&#xA;&#xA;&#xA;============================================================&#xA;&#xA;(Incomplete)&#xA;&#xA;[main]&#xA;#(90% of the partition)&#xA;maxTotalDataSizeMB = 720000 &#xA;&#xA;# (6 months)&#xA;frozenTimePeriodInSecs = 15552000&#xA;&#xA;# Specify a cold to frozen directory else data will be deleted after it rolls off&#xA;coldToFrozenDir = $SPLUNK_DB/defaultdb/frozendb&#xA;&#xA;#&#xA;maxHotSpanSecs&#xA;&#xA;#From warm to cold; once the number of maxWarmDBCount is reached, the older will be rolled.&#xA;#Default = 300&#xA;maxWarmDBCount&#xA;&#xA;#From cold to frozen, once the `maxTotalDataSizeMB` is reached (for hot+warm+cold) or once the `frozenTimePeriodInSecs` reached. Those buckets will be deleted, unless you defined a `coldToFrozenScript` to archive them somewhere.&#xA;frozenTimePeriodInSecs&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;========================&#xA;Additional Troubleshooting:&#xA;Tsidx directory growing:&#xA;- https://answers.splunk.com/answers/377822/tsidx-topologycruncy.html#answer-378209&#xA;&#xA;&#xA;&#xA;=================================================&#xA;This document is proprietary and confidential. No part of this document may be &#xA;disclosed in any manner to a third party without the prior written consent of &#xA;CTAC.&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
  </channel>
</rss>
